**************************************************************

JOB-CUBE2 求人サイト構築システム
設置マニュアル

Regist 2019/11/20 Rev.913

**************************************************************

システムの設置方法は下記を参照下さい。

-------------------------------------------------------------
■インストール手順
-------------------------------------------------------------

１．MySQLの暗号キーを設定します。

「jobcube2_***.zip」を解凍(展開)し、

「./custom/extends/sqlConf.php」ファイルを開き
下記の値(暗号キー)を16桁の英数字で変更ください。

//the 128 bit key value for crypting
$CONFIG_SQL_PASSWORD_KEY = 'abcdeabcdeabcdea';

※SQLiteを利用される場合は、変更する必要はございませんので
そのまま２へお進みください。

-------------------------------------------------------------

２．ID生成規則の設定をします。

デフォルトでは各種データのIDを連番で生成するように設定されていますが、
IDをランダムな文字列で生成するように設定することも可能です。

「./custom/extends/initConf.php」を開き

$MAIN_ID_TYPE = 'num';
を
$MAIN_ID_TYPE = 'hash';

と書き換えてください。

※運用中のシステムでは変更しないでください。連番・ランダムIDが混在してしまいます。

-------------------------------------------------------------

３．システムをインストールします。

システムファイルをご利用のサーバーにアップロードし、ブラウザで下記URLにアクセスします。

http://設置先/tool.php
※初期設定パスワードは「admin」となっております。

インストールウィザードが表示されますので、説明に従って各種設定をしてください。
※データベースにMySQLを利用される場合は、事前にデータベースを作成してください。


■パーミッションの設定について

インストールウィザードの「書き込み権限の設定」ではサーバー環境によっては、
設置ファイルのパーミッションを設定できない場合がございます。

パーミッション変更ができない場合、エラーメッセージと共に画面に変更が必要なファイル名の一覧が表示されますので、
ウィザードの指示に従ってFTP接続情報を設定する、または手動でパーミッション設定をしてください。

■手動でのパーミッション設定について

上記手順でパーミッション変更ができない場合は、
ＦＴＰクライアントツールから、以下のファイルとディレクトリのパーミッションを変更してください。

./feed/			777
./feed/*		777
./file/			777
./file/*		777
./logs/			777
./logs/*.log		666
./db/				777
./db/tdb/			777
./db/tdb/*			777
./db/tdb_hash/			777
./db/tdb_hash/*			777
./db/tdb/*/*.csv		666
./db/tdb_hash/*/*.csv		666
./module/*/db/tdb		777
./module/*/db/tdb_hash		777
./module/*/db/tdb/*.csv		666
./module/*/db/tdb_hash/*.csv	666
./custom/		777
./custom/head_main.php	666
./custom/extends	777
./custom/extends/*	666
./templateCache/	777
./templateCache/*	666

※[*]は以下ディレクトリを含め全てのという意味です。

-------------------------------------------------------------

■データベース接続の手動設定について

インストールウィザード「データベース接続の設定」で設定すると、
「./custom/extends/sqlConf.php」ファイルに変更が記録されます。
ウィザードで設定が上手くいかない場合は、下記手順をお試しください。

「./custom/extends/sqlConf.php」を開き

   $SQL_MASTER = 'SQLiteDatabase';
// $SQL_MASTER = 'MySQLDatabase';
を
// $SQL_MASTER = 'SQLiteDatabase';
   $SQL_MASTER = 'MySQLDatabase';

と書き換えて頂き、
各サーバの設定に従いデータベース名、管理ユーザーID、PASSを設定してください。

$DB_NAME    = 'jc2'; // データベース名
$SQL_ID     = 'root';    // データベース管理ユーザーＩＤ
$SQL_PASS   = '';        // データベース管理ユーザーＰＡＳＳ

SQLサーバーが指定されている場合は下記設定も変更ください。

$SQL_SERVER = 'localhost'; // SQLのサーバ

-------------------------------------------------------------

※サーバー状況により非常に時間が掛かる場合がございます。

インストールウィザード「その他の設定」まで完了後、
設置先ＴＯＰページ（index.php）にアクセス頂き、
ページが正常に表示されていれば、インストールは完了です。

※「tool.php」はご利用後、削除して頂くか、パスワードを変更ください。

※システムのURLが正常に表示されない場合は、
システム直下にある「.htaccess」の「RewriteEngine on」の下に
 RewriteBase [URLのパス]
を記述してください。
記述例：
システムのURLが「http://example.com/」の場合、
 RewriteBase /

システムのURLが「http://example.com/jobcube2/」の場合、
 RewriteBase /jobcube2

続けて「設定手順」を参照し各種設定をしてください。

-------------------------------------------------------------

■設定手順

１．管理者ログインページにアクセスし、ログインします。

http://設置先/login.php

※管理者の初期ID、パスワードは下記のとおりです。
ID          admin@example.com
パスワード  admin

２．左メニューの「パスワードの設定」から管理者のログインID(メールアドレス)、パスワードを変更してください。

２．左メニューからそれぞれ
「システムの設定」「ユーザーの設定」「求人情報の設定」「課金の設定」で設定をしてください。

※設定項目は各種画面の項目名をご覧下さい。

-------------------------------------------------------------

■企業の利用料金の請求について

・利用料金の請求は、月毎に登録されている企業のメールアドレス宛に送られます。
・「課金の設定」で「請求締め日」と「請求日」を設定できます。
※利用料金の請求には下記cronの設定が必要です。

・企業への利用料金の集計(目安:毎日)
└例）/usr/local/bin/php /var/www/html/cron.php paycalc 0 5 * * *
※管理画面「課金の設定」で設定した締め日の "翌日" に集計処理をします。
※集計時点では企業へ請求されず、企業画面の請求一覧にも表示されません。
※締め日翌日以外の日は何もせずに処理を終了します。

・企業への利用料金の請求(目安:毎日)
└例）/usr/local/bin/php /var/www/html/cron.php billing 0 10 * * *
※管理画面「課金の設定」で設定した請求日に企業へ請求します。
※請求日以外の日は何もせずに処理を終了します。

-------------------------------------------------------------

■cronの設定について

下記機能につきましては、cronの設定が必要です。

・当日の求人へのアクセス数集計(目安:毎時、更新頻度を下げるなら１日に１～２回)
└例）/usr/local/bin/php /var/www/html/cron.php jobCountUpdate 0 * * * *
※管理画面「求人情報の設定」のページビューを「管理者公開」か「求人企業まで公開」に設定することで、求人へのアクセスをカウントします。
※アクセスランキングにはcronを実行した当日のアクセス数のみで順位が決定します。

・非会員、求職者TOPページの勤務形態、職種、特徴の該当求人数の集計処理(目安:毎時、更新頻度を下げるなら１日に１～２回)
└例）[phpのコマンドパス] /var/www/html/cron.php countUpdate 0 * * * *

・DMの予約送信(目安:１５分に１回)
└例）[phpのコマンドパス] /var/www/html/cron.php sendReserveMail */15 * * * *

・一定期間経過したスカウトの自動辞退処理(目安:１日に１～２回)
├例）[phpのコマンドパス] /var/www/html/cron.php declineScout 0 9,19 * * *
└該当企業ユーザーへメールが送信されます。

・中途採用求人のおすすめ掲載期限切れ事前通知(１日に１回)
├例）[phpのコマンドパス] /var/www/html/cron.php attentionNoticeMid 0 9 * * *
└該当企業ユーザーへメールが送信されます。

・新卒採用求人のおすすめ掲載期限切れ事前通知(１日に１回)
├例）[phpのコマンドパス] /var/www/html/cron.php attentionNoticeFresh 0 9 * * *
└該当企業ユーザーへメールが送信されます。

・中途採用求人の利用期間の期限切れ事前通知(１日に１回)
├例）[phpのコマンドパス] /var/www/html/cron.php userLimitNoticeMid 5 9 * * *
└該当企業ユーザーへメールが送信されます。

・新卒採用求人の利用期間の期限切れ事前通知(１日に１回)
├例）[phpのコマンドパス] /var/www/html/cron.php userLimitNoticeFresh 5 9 * * *
└該当企業ユーザーへメールが送信されます。

・Indeed XMLフィードの更新(１日に１回)
├例）[phpのコマンドパス] /var/www/html/cron.php updateIndeedFeed 0 4 * * *
└Indeedの「スポンサー求人広告」に掲載するためのXMLフィードを、
  サイトで掲載中の求人情報から生成します。

・企業の管理の一覧の契約状態の表示更新(１日に１回)
└例）[phpのコマンドパス] /var/www/html/cron.php setPayFlg 0 9 * * *

-------------------------------------------------------------

■パッケージアップデート通知について

管理者ページでパッケージのアップデート情報や新製品のリリース情報を確認できます。
通知が不要な場合は、
「./custom/conf.php」ファイルの記述内容を変更ください。

$UPDATE_NOTICE = true;
を
$UPDATE_NOTICE = false;

に書き換えると通知が非表示になります。

-------------------------------------------------------------

■SSLの導入について

SSLを導入して頂く場合、下記のように設定ファイルを変更してください。
./custom/extentds/sslConf.php

 //SSLへのリダイレクトを有効に
 $CONFIG_SSL_ENABLE = true;

※初期設定はOFF(false)になっています。

-------------------------------------------------------------

■Google Maps APIキー 取得について

「地図から求人を検索する」機能を有効にするには、
Google Maps APIキーの取得と設定が必要です。

下記手順に従って、APIキーの取得と設定を進めてください。

キーの取得にはGoogleアカウントが必要です。
事前にご用意ください。

１．Googleアカウントでログイン

下記のURLにアクセスし、ログインします。
https://developers.google.com/maps/web/


２．画面右上の「キーを取得」ボタンをクリック

キー取得の説明が画面に表示されます。
「続ける」ボタンをクリックしてください。


３．「アプリケーションを登録するプロジェクトの選択」

「プロジェクトを作成」を選択し、「続行」ボタンをクリックしてください。
※プロジェクトの作成が完了すると、ブラウザAPIキーの作成画面に移動します。


４．APIキーの設定

ブラウザAPIキーの作成画面では、下記の項目を入力し、
画面下部の「作成」ボタンをクリックしてください。

・名前
・このHTTP リファラー（ウェブサイト）からのリクエストを受け入れる(省略可)

上記、HTTPリファラーの項目には、システムを設置したURLを記入します。

また、ワイルドカード(*)が使用できます。
example.comと下位のURLを指定する場合は、以下のように記入します。
example.com/*


５．APIキーをコピー

表示されているAPIキーをコピーしておきます。


６．JOB-CUBE2に管理者でログイン

「システムの設定」ページに移動し、
「地図検索設定」の欄に先ほどコピーしたキーを貼り付け、
設定を保存してください。


７．正しく設定できたことを確認する

設置先環境の以下のURLにアクセスし、
GoogleMapが表示されていれば正しく設定できています。
/index.php?app_controller=other&key=MapSearch

-------------------------------------------------------------

■アップロードファイルの保存先をAmazonS3に変更する

./custom/extends/filebaseConf.php.php
を以下に変更する
$CONF_FILEBASE_FLAG = true;
$CONF_FILEBASE_ENGINE = 'aws_S3';


./module/filebase/aws_S3/custom/conf/awsS3Conf.php
にS3アクセスにアクセスするための設定を入力する

$AWS_S3_USEDFLAG = true ; // awsS3に保存する場合はtrueにする
$AWS_S3_ACCESS_KEY = ""; // awsS3にアクセスするためのアクセスキー
$AWS_S3_SEACRET_KEY = ""; // awsS3にアクセスするためのシークレットキー
$AWS_S3_BUCKET_NAME = "base"; // S3に作成されているバケット名
$AWS_S3_PARTITION = "basic"; // ファイルを保存するバケット内のフォルダ

-------------------------------------------------------------

■一部URLを静的化する

JC2では、SEO対策として一部下記のような箇所のリンクURLを静的化して出力することが出来ます。
・フッター部分の都道府県リンクリスト
・求人詳細ページのパンくず
・求人検索結果ページの下部のリンクリスト

静的URL出力を有効にする場合は custom/conf.php の
$STATIC_URL_FLG 変数を true にしていただく必要があります。

$STATIC_URL_FLG = false; //静的URL出力の無効
↓
$STATIC_URL_FLG = true; //静的URL出力の有効


※※※ 静的URL出力の有効後にシステムのURLが正常に表示されない場合、
システム直下にある「.htaccess」の「RewriteEngine on」の下に
  RewriteBase [URLのパス]
を記述してください。

記述例：
システムのURLが「http://example.com/」の場合、
  RewriteBase /

システムのURLが「http://example.com/jc2/」の場合、
  RewriteBase /jc2

-------------------------------------------------------------

・当システムは独自のライセンス管理をしております。
不正な利用が発見された場合には、ライセンス費用をご請求する場合が御座います。
・ご不明な点が御座いましたらお気軽にお問い合わせ下さい。

■━━━━━━━━━━━━━━━━━━━━━━━

株式会社ウェブスクウェア
http://www.websquare.co.jp/

本　　社：大阪府門真市新橋町17-8ライズビル4F
開発本部：滋賀県草津市西渋川1-1-18イーカムビル4F
TEL 077-500-0226　/　FAX 077-500-0823
※製品に関するお問い合わせはメールにてお願いしております。

▼WEBパッケージ：http://www.websquare.co.jp/products/
▼パートナー制度：http://www.ws-partner.net/
▼製品技術資料/マニュアル：http://wsmanual.net/


※営業時間：平日10:00～18:00  土日祝は休日となります。
━━━━━━━━━━━━━━━━━━━━━━━■
